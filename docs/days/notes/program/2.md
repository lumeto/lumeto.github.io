## 手写Ajax

```js

/**
 *  手写 ajax
 * @param {*} options 
 */
function myAjax(options) {
    let url = options.url
    const method = options.method.toLocaleLowerCase() || 'get'
    const async = options.async || false
    const data = options.data || {}

    const xhr = new XMLHttpRequest()
    xhr.open(method, url, async)

    if (options.timeout && options.timeout > 0) {
        xhr.timeout = options.timeout
    }

    return new Promise((resolve, reject) => {
        xhr.timeout = () => reject && reject('请求超时')
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    resolve(JSON.parse(xhr.responseText))
                } else if (xhr.status === 404 || xhr.status === 500) {
                    reject(new Error('404 not found'))
                }
            }
        }
        let paramArr = []
        let encodeData
        if (data instanceof Object) {
            for (let key in data) {
                paramArr.push(encodeURIComponent(key) + '=' + encodeURIComponent(data[key]))
            }
            encodeData = paramArr.join('&')
        }
        if (method === 'get') {
            xhr.send(null)
        } else {
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=UTF-8')
            xhr.send(encodeData)
        }
    })
}
```

```js
// 使用

myAjax({
    url: 'http://xxxx',
    method: 'post',
    async: true,
    timeout: 1000,
    data: {
        test: 1,
        aaa: 2
    }
}).then((res) => {
    console.log("res", res)
}).catch((err) => {
    console.log("err", err)
});
```