## JS-Web-API-事件

### 事件绑定
```html
<button id="button">按钮</button>
```
```js
const btn = document.getElementById("button");
btn.addEventListener("click", (event) => {
  console.log("click");
});
```
#### 普通版绑定函数
```js
function bindEvent(elem, type, fn) {
  elem.addEventListener(type, fn);
}

const btn = document.getElementById("button");
bindEvent(btn, "click", (e) => {
  e.preventDefault(); // 阻止默认行为
  alert("click");
});
```

### 事件冒泡
#### 事件冒泡的流程

（1）基于DOM树形结构

（2）事件会顺着触发的元素往父元素冒泡

（3）事件冒泡的应用场景：事件代理，它基于事件冒泡
```html
<div id="div1">
  <p id="p1">激活</p>
  <p id="p2">取消</p>
</div>
<div id="div2">
  <p id="p3">取消</p>
  <p id="p4">取消</p>
</div>
```
```js
const body = document.body;
const p1 = document.getElementById("p1");

function bindEvent(elem, type, fn) {
  elem.addEventListener(type, fn);
}

bindEvent(body, "click", (e) => {
  console.log("取消");
});

bindEvent(p1, "click", (e) => {
  console.log("激活");
});
```
::: tip
这时点击 p1 打印出 `激活` `取消` ，发生了事件冒泡
:::
#### 阻止往上冒泡 event.stopPropagation()
```js
// 阻止事件冒泡
bindEvent(p1, "click", (e) => {
  // 阻止默认行为
  e.stopPropagation();
  console.log("激活");
});
```
::: tip
这时点击 p1 只打印出 `激活` 
:::


### 事件代理
::: tip
把事件绑定到父元素上，使代码简洁，减少浏览器内存占用，但不要滥用
:::

#### 代理绑定
```html
<ul id="ul">
  <li>a1</li>
  <li>a2</li>
  <li>a3</li>
</ul>
```
```js
function bindEvent(elem, type, fn) {
  elem.addEventListener(type, fn);
}
const div1 = document.getElementById("ul");
// 事件代理
bindEvent(div1, "click", (e) => {
  // 阻止默认行为
  e.stopPropagation();
  const target = event.target;
  if (target.nodeName === "LI") {   // LI 点击的元素 大写。
    console.log(target.innerHTML);
  }
});
```

### 通用绑定函数
**支持代理绑定**
```js

function bindEvent(elem, type, selector, fn) {
    // 如果第四个参数不存在
    // 匹配bindEvent(div1, 'click', function(e) {})的情况
    if (fn == null) {
       fn = selector
       selector = null
    }
    
    elem.addEventListener(type, event => {
        const target = event.target
        // 代理绑定
        if(selector) {
            // 判断当前target是否为指定的元素
            if (target.matches(selector)) {
                // 绑定this
                fn.call(target, event)
            }
        } else {
            // 普通绑定
            // 绑定this
            fn.call(target, event)
        }
    })
}
```
**使用**
```js
// 普通绑定
bindEvent(ul, "click", function (e) {
  console.log(e);
});

// 代理绑定
bindEvent(ul, "click", "LI", function (e) {
  console.log(e.target);
});
```

### 相关面试题
无限下拉的图片列表，如何监听每个图片的点击

（1）事件代理

（2）用e.target来获取触发的元素

（3）用matches来判断是否是触发元素